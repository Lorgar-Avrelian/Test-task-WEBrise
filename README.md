# Тестовое задание

## Техническое задание: Реализация микросервиса

### Описание задачи

Необходимо разработать микросервис на Spring Boot 3, который будет предоставлять _REST API_ для управления
пользователями и их подписками на сервисы.  
Проект должен использовать Java 17.  
**Срок выполнения:** 2 дня.

### Функциональные требования

#### 1 API для управления пользователями

- создание пользователя;
- получение информации о пользователе;
- обновление данных пользователя;
- удаление пользователя.

#### 2 API для подписок

- добавление подписки пользователю;
- получение списка подписок пользователя;
- удаление подписки.

> Подписки представляют собой подписки на цифровые сервисы, такие как _YouTube Premium_, _VK Музыка_, _Яндекс.Плюс_,
> _Netflix_ и другие стриминговые платформы.

#### 3 Интеграция с базой данных

- использовать _PostgreSQL_;
- таблицы: `users`, `subscriptions`.

#### 4 Логирование

- логирование через _SLF4J_.

#### 5 Docker

- создать `Dockerfile` для развертывания сервиса;
- разработать `docker-compose.yml`, который позволит локально запускать проект вместе с базой данных.

### Требования к API

Примерные эндпоинты:

- **POST** `/users` - создать пользователя;
- **GET** `/users/{id}` - получить информацию о пользователе;
- **PUT** `/users/{id}` - обновить пользователя;
- **DELETE** `/users/{id}` - удалить пользователя;
- **POST** `/users/{id}/subscriptions` - добавить подписку;
- **GET** `/users/{id}/subscriptions` - получить подписки пользователя;
- **DELETE** `/users/{id}/subscriptions/{sub_id}` - удалить подписку;
- **GET** `/subscriptions/top` - получить ТОП-3 популярных подписок.

# Пояснение к решению

После поиска данных о подписках на указанные в задании ресурсы (описания _API_) привёл к выводу, что абсолютно все
подписки, независимо от их разработчиков, имеют ряд общих параметров: название, описание и тариф по данной подписке.  
Однако все подписки отличаются друг от друга по наименованию и диапазонам значений данных о пользователе, необходимых
для авторизации на соответствующей платформе (ресурсе).

### Поэтому были приняты следующие архитектурные решения:

1. Созданы модели:
    - пользователя (_User_) для хранения данных пользователя;
    - подписки (_Subscription_) для хранения общих параметров подписки;
    - параметров подписки пользователя (_SubscriptionData_) для сопоставления пользователей, подписок, а также названий
      параметров и их значений для конкретной подписки конкретного пользователя;
    - значений параметров подписки пользователя (_DataValues_) для хранения параметров подписки и их значений для
      конкретного сочетания пользователь-подписка;
2. Для данных моделей созданы соответствующие таблицы в БД:
    - _users_, имеющая связь _OneToMany_ с таблицей _subscription_data_;

   | **id** | **login** | **name** | **surname** |
   |:------:|:---------:|:--------:|:-----------:|
   |        |           |          |             |

    - _subscriptions_, имеющая связь _OneToMany_ с таблицей _subscription_data_;

   | **id** | **title** | **description** | **tariff** |
   |:------:|:---------:|:---------------:|:----------:|
   |        |           |                 |            |

    - _subscription_data_, имеющая связь _OneToMany_ с таблицей _data_values_ и _ManyToOne_ с таблицами _users_ и
      _subscriptions_;

   | **id** | **user_id** | **subscription_id** |
   |:------:|:-----------:|:-------------------:|
   |        |             |                     |

    - _data_values_, имеющая связь _ManyToOne_ с таблицей _subscription_data_;

   | **id** | **subscription_id** | **key** | **value** |
   |:------:|:-------------------:|:-------:|:---------:|
   |        |                     |         |           |

3. Реализованы сервисы, обеспечивающие работу приложения, а также следующие итоговые _API_:
    - для управления подписками:
        * `GET /subscriptions` - для получения списка со всеми зарегистрированными подписками (поддерживает пагинацию);
        * `POST /subscriptions` - для создания новой подписки;
        * `GET /subscriptions/{id}` - для получения общих данных подписки по её _ID_;
        * `PUT /subscriptions/{id}` - для изменения общих данных подписки по её _ID_;
        * `DELETE /subscriptions/{id}` - для удаления подписки по её _ID_;
    - для управления пользователями:
        * `GET /users` - для получения списка со всеми зарегистрированными пользователями (поддерживает пагинацию);
        * `POST /users` - для создания нового пользователя;
        * `GET /users/{id}` - для получения общих данных пользователя по его _ID_;
        * `PUT /users/{id}` - для изменения общих данных пользователя по его _ID_;
        * `DELETE /users/{id}` - для удаления пользователя по его _ID_;
    - для управления подписками пользователей:
       * `GET /users/{id}/subscriptions` - для получения списка подписок пользователя;
       * `POST /users/{id}/subscriptions` - для добавления новой подписки пользователю;
       * `DELETE /users/{id}/subscriptions/{sub_id}` - для удаления подписки пользователя;
    - для управления параметрами подписок пользователей:
       * `PUT /users/{id}/subscriptions/{sub_id}` - для добавления/изменения учётных данных пользователя для данной подписки;
       * `GET /users/{id}/subscriptions/{sub_id}` - для получения учётных данных пользователя для данной подписки;
    - информационные:
        * `GET /subscriptions/top` - для получения топ 3 подписок по количеству пользователей.

Описание _API_ можно увидеть после запуска приложения по [адресу](http://localhost:8080/swagger-ui/index.html) в 
интерфейсе _Swagger UI_.  

### Применённые технологии:

- Java 17;
- Spring Boot 3.4.5;
- Spring Web;
- Spring Data JPA;
- Swagger UI;
- PostgreSQl;
- Liquibase;
- LogBack (SLF4J);
- Mapstruct;
- Docker (Docker-compose).

